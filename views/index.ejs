<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Veloura - Luxury Jewelry Collection</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600&display=swap"
        rel="stylesheet">
    <style>
        @keyframes scroll {
            0% {
                transform: translateX(100%);
            }

            100% {
                transform: translateX(-100%);
            }
        }

        .scroll-text {
            animation: scroll 15s linear infinite;
        }

        .star-rating {
            color: #fbbf24;
        }

        .font-playfair {
            font-family: 'Playfair Display', serif;
        }

        .font-inter {
            font-family: 'Inter', sans-serif;
        }

        /* Premium gradient backgrounds */
        .premium-gradient {
            background: linear-gradient(135deg, #1e1e1e 0%, #2d2d2d 50%, #1a1a1a 100%);
        }

        .gold-gradient {
            background: linear-gradient(135deg, #d4af37 0%, #ffd700 50%, #b8860b 100%);
        }

        /* Custom shadows for premium look */
        .premium-shadow {
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(255, 255, 255, 0.05);
        }

        /* Search bar styling */
        .search-container {
            position: relative;
            width: 100%;
            max-width: 500px;
        }

        .search-input {
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .search-input:focus {
            border-color: #fbbf24;
            box-shadow: 0 0 0 3px rgba(251, 191, 36, 0.1);
        }

        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            z-index: 50;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }

        .search-suggestions.show {
            display: block;
        }

        .suggestion-item {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid #f3f4f6;
            transition: background-color 0.2s ease;
        }

        .suggestion-item:hover {
            background-color: #f9fafb;
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        /* Enhanced navbar notification badges - FIXED VERSION */
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ef4444 !important;
            color: white !important;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex !important;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            transition: all 0.3s ease;
            z-index: 10;
        }

        /* Hide badge when count is 0 - with !important to override */
        .notification-badge.hidden {
            display: none !important;
        }

        /* Badge animations - ENHANCED */
        @keyframes badgePulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.3);
            }

            100% {
                transform: scale(1);
            }
        }

        .notification-badge.animate {
            animation: badgePulse 0.5s ease-in-out;
        }

        /* Mobile responsive adjustments */
        @media (max-width: 768px) {
            .search-container {
                max-width: 300px;
            }
        }
    </style>
</head>

<body class="bg-gray-50 font-inter">
    <!-- Navigation Bar -->
    <nav class="premium-gradient shadow-2xl sticky top-0 z-50 border-b border-gray-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <!-- Logo - Left Side -->
                <div class="flex-shrink-0">
                    <a href="/" class="text-3xl font-bold font-playfair">
                        <span class="text-white">VEL</span><span class="text-yellow-400">OURA</span>
                        <% if (isOwner) { %>
                            <span class="text-yellow-400 text-sm ml-1">ADMIN</span>
                            <% } %>
                    </a>
                </div>

                <!-- Search Bar - Center -->
                <div class="flex-1 max-w-2xl mx-8">
                    <div class="search-container">
                        <div class="relative">
                            <input type="text" id="searchInput" placeholder="Search for Chains..."
                                class="search-input w-full px-4 py-3 pl-12 pr-12 bg-white rounded-full text-gray-700 placeholder-gray-400 focus:outline-none"
                                onkeyup="handleSearch(event)" onfocus="showSuggestions()" onblur="hideSuggestions()">
                            <div class="absolute left-4 top-1/2 transform -translate-y-1/2">
                                <i class="fas fa-search text-gray-400"></i>
                            </div>
                            <button onclick="performSearch()"
                                class="absolute right-3 top-1/2 transform -translate-y-1/2 bg-yellow-500 hover:bg-yellow-600 text-black px-3 py-1 rounded-full transition-colors duration-200">
                                <i class="fas fa-search text-sm"></i>
                            </button>
                        </div>

                        <!-- Search Suggestions Dropdown -->
                        <div id="searchSuggestions" class="search-suggestions">
                            <!-- Dynamic suggestions will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Right Side Navigation -->
                <div class="flex items-center space-x-4">
                    <% if (!loggedin) { %>
                        <!-- Guest User Icons -->
                        <a href="/users/register"
                            class="text-white hover:text-yellow-400 transition-all duration-300 group"
                            title="Login to access shop">
                            <div
                                class="bg-gray-700 group-hover:bg-blue-500 p-3 rounded-full transition-all duration-300">
                                <i class="fas fa-store text-lg"></i>
                            </div>
                        </a>
                        <a href="/users/register"
                            class="text-white hover:text-yellow-400 transition-all duration-300 group"
                            title="Login to access wishlist">
                            <div
                                class="bg-gray-700 group-hover:bg-red-500 p-3 rounded-full transition-all duration-300 relative">
                                <i class="fas fa-heart text-lg"></i>
                            </div>
                        </a>
                        <a href="/users/register"
                            class="text-white hover:text-yellow-400 transition-all duration-300 group"
                            title="Login to access cart">
                            <div
                                class="bg-gray-700 group-hover:bg-yellow-500 p-3 rounded-full transition-all duration-300 relative">
                                <i class="fas fa-shopping-bag text-lg"></i>
                            </div>
                        </a>
                        <a href="/users/register"
                            class="text-white hover:text-yellow-400 transition-all duration-300 group">
                            <div
                                class="bg-green-600 group-hover:bg-green-500 p-3 rounded-full transition-all duration-300">
                                <i class="fas fa-user text-lg"></i>
                            </div>
                        </a>
                        <% } else if (isOwner) { %>
                            <!-- Owner Icons -->
                            <a href="/shop" class="text-white hover:text-yellow-400 transition-all duration-300 group"
                                title="View Shop">
                                <div
                                    class="bg-gray-700 group-hover:bg-blue-500 p-3 rounded-full transition-all duration-300">
                                    <i class="fas fa-store text-lg"></i>
                                </div>
                            </a>
                            <a href="/owners/manage-products"
                                class="text-white hover:text-yellow-400 transition-all duration-300 group"
                                title="Manage Products">
                                <div
                                    class="bg-blue-600 group-hover:bg-blue-500 p-3 rounded-full transition-all duration-300">
                                    <i class="fas fa-box text-lg"></i>
                                </div>
                            </a>
                            <a href="/wishlist"
                                class="text-white hover:text-red-400 transition-all duration-300 group relative"
                                title="Wishlist">
                                <div
                                    class="bg-gray-700 group-hover:bg-red-500 p-3 rounded-full transition-all duration-300">
                                    <i class="fas fa-heart text-lg"></i>
                                </div>
                                <span id="wishlistBadge"
                                    class="notification-badge <%= (typeof wishlistCount !== 'undefined' && wishlistCount > 0) ? '' : 'hidden' %>">
                                    <%= typeof wishlistCount !=='undefined' ? wishlistCount : 0 %>
                                </span>
                            </a>
                            <a href="/cart"
                                class="text-white hover:text-yellow-400 transition-all duration-300 group relative"
                                title="Shopping Cart">
                                <div
                                    class="bg-gray-700 group-hover:bg-yellow-500 p-3 rounded-full transition-all duration-300">
                                    <i class="fas fa-shopping-bag text-lg"></i>
                                </div>
                                <span id="cartBadge"
                                    class="notification-badge <%= (typeof cartCount !== 'undefined' && cartCount > 0) ? '' : 'hidden' %>">
                                    <%= typeof cartCount !=='undefined' ? cartCount : 0 %>
                                </span>
                            </a>

                            <!-- Owner Dropdown Menu -->
                            <div class="relative group">
                                <button
                                    class="flex items-center text-white hover:text-yellow-400 transition-all duration-300">
                                    <div
                                        class="bg-yellow-600 hover:bg-yellow-500 p-3 rounded-full transition-all duration-300">
                                        <i class="fas fa-user-cog text-lg text-black"></i>
                                    </div>
                                </button>

                                <!-- Dropdown Menu -->
                                <div
                                    class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                                    <div class="py-2">
                                        <a href="/owners/dashboard"
                                            class="block px-4 py-2 text-gray-800 hover:bg-yellow-50 transition-colors">
                                            <i class="fas fa-tachometer-alt mr-2 text-yellow-600"></i>Dashboard
                                        </a>
                                        <a href="/owners/create-product"
                                            class="block px-4 py-2 text-gray-800 hover:bg-yellow-50 transition-colors">
                                            <i class="fas fa-plus mr-2 text-yellow-600"></i>Create Product
                                        </a>
                                        <div class="border-t border-gray-200 my-1"></div>
                                        <a href="/users/logout"
                                            class="block px-4 py-2 text-red-600 hover:bg-red-50 transition-colors">
                                            <i class="fas fa-sign-out-alt mr-2"></i>Logout
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <% } else { %>
                                <!-- Regular User Icons -->
                                <a href="/shop"
                                    class="text-white hover:text-yellow-400 transition-all duration-300 group"
                                    title="Shop">
                                    <div
                                        class="bg-gray-700 group-hover:bg-blue-500 p-3 rounded-full transition-all duration-300">
                                        <i class="fas fa-store text-lg"></i>
                                    </div>
                                </a>
                                <a href="/wishlist"
                                    class="text-white hover:text-red-400 transition-all duration-300 group relative"
                                    title="Wishlist">
                                    <div
                                        class="bg-gray-700 group-hover:bg-red-500 p-3 rounded-full transition-all duration-300">
                                        <i class="fas fa-heart text-lg"></i>
                                    </div>
                                    <span id="wishlistBadge"
                                        class="notification-badge <%= (typeof wishlistCount !== 'undefined' && wishlistCount > 0) ? '' : 'hidden' %>">
                                        <%= typeof wishlistCount !=='undefined' ? wishlistCount : 0 %>
                                    </span>
                                </a>
                                <a href="/cart"
                                    class="text-white hover:text-yellow-400 transition-all duration-300 group relative"
                                    title="Shopping Cart">
                                    <div
                                        class="bg-gray-700 group-hover:bg-yellow-500 p-3 rounded-full transition-all duration-300">
                                        <i class="fas fa-shopping-bag text-lg"></i>
                                    </div>
                                    <span id="cartBadge"
                                        class="notification-badge <%= (typeof cartCount !== 'undefined' && cartCount > 0) ? '' : 'hidden' %>">
                                        <%= typeof cartCount !=='undefined' ? cartCount : 0 %>
                                    </span>
                                </a>

                                <!-- User Dropdown Menu -->
                                <div class="relative group">
                                    <button
                                        class="flex items-center text-white hover:text-yellow-400 transition-all duration-300">
                                        <div
                                            class="bg-green-600 hover:bg-green-500 p-3 rounded-full transition-all duration-300">
                                            <i class="fas fa-user text-lg"></i>
                                        </div>
                                    </button>

                                    <!-- Dropdown Menu -->
                                    <div
                                        class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                                        <div class="py-2">
                                            <a href="/user/profile"
                                                class="block px-4 py-2 text-gray-800 hover:bg-yellow-50 transition-colors">
                                                <i class="fas fa-user-circle mr-2 text-yellow-600"></i>My Profile
                                            </a>
                                            <a href="/user/orders"
                                                class="block px-4 py-2 text-gray-800 hover:bg-yellow-50 transition-colors">
                                                <i class="fas fa-box mr-2 text-yellow-600"></i>My Orders
                                            </a>
                                            <a href="/user/purchases"
                                                class="block px-4 py-2 text-gray-800 hover:bg-yellow-50 transition-colors">
                                                <i class="fas fa-receipt mr-2 text-yellow-600"></i>Purchase History
                                            </a>
                                            <div class="border-t border-gray-200 my-1"></div>
                                            <a href="/users/logout"
                                                class="block px-4 py-2 text-red-600 hover:bg-red-50 transition-colors">
                                                <i class="fas fa-sign-out-alt mr-2"></i>Logout
                                            </a>
                                        </div>
                                    </div>
                                </div>
                                <% } %>
                </div>
            </div>
        </div>
    </nav>

    <!-- Rest of your existing index.ejs content remains the same -->
    <!-- Hero Carousel Section -->
    <div class="relative h-96 md:h-[500px] overflow-hidden">
        <div id="carousel" class="flex transition-transform duration-500 h-full">
            <% heroImages.forEach((image, index)=> { %>
                <div class="w-full h-full flex-shrink-0 relative">
                    <%
                        // Support multiple hero image input formats:
                        // 1) Buffer (existing behavior)
                        // 2) Public URL/path string (e.g., "/images/hero-1.jpg")
                        // 3) Object with `imageUrl` string
                        const heroSrc = (typeof image === 'string')
                            ? image
                            : (image && image.imageUrl)
                                ? image.imageUrl
                                : null;
                    %>
                    <% if (image && image.length > 0) { %>
                        <!-- Buffer-based image -->
                        <img src="data:image/jpeg;base64,<%= image.toString('base64') %>"
                            alt="Hero Slide <%= index + 1 %>"
                            class="w-full h-full object-cover">
                    <% } else if (heroSrc) { %>
                        <!-- Public folder image / URL -->
                        <img src="<%= heroSrc %>"
                            alt="Hero Slide <%= index + 1 %>"
                            class="w-full h-full object-cover">
                    <% } else { %>
                        <div
                            class="w-full h-full premium-gradient flex items-center justify-center relative overflow-hidden">
                            <div class="text-center">
                                <i class="fas fa-image text-6xl text-yellow-400 mb-4"></i>
                                <p class="text-white text-xl font-playfair">Luxury Jewelry Collection</p>
                            </div>
                        </div>
                    <% } %>
                </div>
                <% }) %>
        </div>

        <!-- Carousel Dots -->
        <div class="absolute bottom-6 left-1/2 transform -translate-x-1/2 flex space-x-3">
            <% heroImages.forEach((_, index)=> { %>
                <button onclick="goToSlide(<%= index %>)"
                    class="w-4 h-4 rounded-full carousel-dot transition-all duration-300 <%= index === 0 ? 'bg-yellow-400 scale-125' : 'bg-white/50 hover:bg-white/80' %>">
                </button>
                <% }) %>
        </div>

        <!-- Navigation Arrows -->
        <button onclick="previousSlide()"
            class="absolute left-6 top-1/2 transform -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white p-3 rounded-full transition-all duration-300">
            <i class="fas fa-chevron-left"></i>
        </button>
        <button onclick="nextSlide()"
            class="absolute right-6 top-1/2 transform -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white p-3 rounded-full transition-all duration-300">
            <i class="fas fa-chevron-right"></i>
        </button>
    </div>

    <!-- Featured Chains Section -->
    <section class="py-20 bg-gray-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16">
                <h2 class="text-4xl md:text-5xl font-bold font-playfair text-gray-900 mb-4">
                    Luxury Jewellery Collection
                </h2>
                <p class="text-xl text-gray-600 max-w-2xl mx-auto">
                    Discover our handpicked selection of premium jewelry for the modern connoisseur
                </p>
            </div>

            <!-- Featured Chains -->
            <div class="mb-20">
                <div class="flex items-center justify-between mb-12">
                    <h3 class="text-3xl font-semibold font-playfair text-gray-800">Premium Chains</h3>
                    <a href="/shop?category=chain"
                        class="text-yellow-600 hover:text-yellow-700 font-medium flex items-center">
                        View All Chains <i class="fas fa-arrow-right ml-2"></i>
                    </a>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <% if (featuredChains && featuredChains.length> 0) { %>
                        <% featuredChains.forEach(product=> { %>
                            <div
                                class="group bg-white premium-shadow rounded-2xl overflow-hidden hover:scale-105 transition-all duration-500">
                                <div class="relative h-80 overflow-hidden">
                                    <% if (product.image && product.image.length> 0) { %>
                                        <img src="data:image/jpeg;base64,<%= product.image.toString('base64') %>"
                                            alt="<%= product.name %>"
                                            class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500 bg-[<%= product.bgcolor %>]">
                                        <% } else { %>
                                            <div
                                                class="w-full h-full premium-gradient flex items-center justify-center">
                                                <i class="fas fa-link text-6xl text-yellow-400"></i>
                                            </div>
                                            <% } %>

                                                <!-- Quick Actions Overlay -->
                                                <div
                                                    class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-all duration-300 flex items-center justify-center">
                                                    <div class="flex space-x-4">
                                                        <% if (loggedin) { %>
                                                            <button onclick="addToWishlist('<%= product._id %>')"
                                                                class="bg-white text-black p-3 rounded-full hover:bg-red-500 hover:text-white transition-all duration-300">
                                                                <i class="fas fa-heart"></i>
                                                            </button>
                                                            <button onclick="addToCart('<%= product._id %>')"
                                                                class="bg-yellow-500 text-black p-3 rounded-full hover:bg-yellow-600 transition-all duration-300">
                                                                <i class="fas fa-shopping-cart"></i>
                                                            </button>
                                                            <% } %>
                                                    </div>
                                                </div>

                                                <!-- Discount Badge -->
                                                <% if (product.discount> 0) { %>
                                                    <div
                                                        class="absolute top-4 left-4 bg-red-500 text-white px-3 py-1 rounded-full text-sm font-bold">
                                                        <%= Math.round((product.discount / product.price) * 100) %>% OFF
                                                    </div>
                                                    <% } %>
                                </div>

                                <div class="p-6 bg-[<%= product.panelcolor %>]"
                                    style="color: <%= product.textcolor %>;">
                                    <h4 class="text-xl font-semibold font-playfair mb-2"
                                        style="color: <%= product.textcolor %>;">
                                        <%= product.name || 'Premium Chain' %>
                                    </h4>
                                    <p class="mb-4 text-sm opacity-80" style="color: <%= product.textcolor %>;">
                                        <%= product.description
                                            || 'Exquisitely crafted chain with premium materials and attention to detail'
                                            %>
                                    </p>

                                    <!-- Rating -->
                                    <div class="flex items-center mb-4">
                                        <div class="star-rating mr-2">
                                            <% for(let i=1; i <=5; i++) { %>
                                                <i
                                                    class="fas fa-star text-sm <%= i <= (product.rating || 4.5) ? 'text-yellow-400' : 'text-gray-300' %>"></i>
                                                <% } %>
                                        </div>
                                        <span class="text-sm opacity-70" style="color: <%= product.textcolor %>;">(<%=
                                                product.reviewCount || Math.floor(Math.random() * 100) + 50 %>)</span>
                                    </div>

                                    <!-- Price -->
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-2">
                                            <span class="text-2xl font-bold" style="color: <%= product.textcolor %>;">₹
                                                <%= product.price ? (product.price - (product.discount || 0)) : '2,999'
                                                    %></span>
                                            <% if (product.discount && product.discount> 0) { %>
                                                <span class="text-lg line-through opacity-60"
                                                    style="color: <%= product.textcolor %>;">₹<%= product.price %>
                                                        </span>
                                                <% } %>
                                        </div>

                                        <div class="flex items-center opacity-70"
                                            style="color: <%= product.textcolor %>;">
                                            <i class="fas fa-heart text-sm mr-1"></i>
                                            <span class="text-sm">
                                                <%= product.wishlistCount || Math.floor(Math.random() * 50) + 10 %>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <% }) %>
                                <% } else { %>
                                    <!-- Placeholder cards when no products -->
                                    <% for(let i=0; i < 3; i++) { %>
                                        <div class="bg-white premium-shadow rounded-2xl overflow-hidden">
                                            <div class="h-80 premium-gradient flex items-center justify-center">
                                                <div class="text-center text-yellow-400">
                                                    <i class="fas fa-link text-6xl mb-4"></i>
                                                    <p class="text-white">Premium Chain <%= i + 1 %>
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="p-6">
                                                <h4 class="text-xl font-semibold font-playfair text-gray-900 mb-2">
                                                    Luxury Chain Collection</h4>
                                                <p class="text-gray-600 mb-4 text-sm">Coming soon - Exquisite chains
                                                    crafted with precision</p>
                                                <div class="flex items-center mb-4">
                                                    <div class="star-rating mr-2">
                                                        <% for(let j=1; j <=5; j++) { %>
                                                            <i class="fas fa-star text-sm text-yellow-400"></i>
                                                            <% } %>
                                                    </div>
                                                    <span class="text-sm text-gray-500">(127)</span>
                                                </div>
                                                <div class="flex items-center justify-between">
                                                    <span class="text-2xl font-bold text-gray-900">₹<%= 2999 + (i *
                                                            1000) %></span>
                                                    <div class="flex items-center text-gray-500">
                                                        <i class="fas fa-heart text-sm mr-1"></i>
                                                        <span class="text-sm">
                                                            <%= 45 + (i * 10) %>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <% } %>
                                            <% } %>
                </div>

                <div class="text-center mt-12">
                    <a href="/shop"
                        class="gold-gradient text-black px-8 py-4 rounded-lg font-semibold hover:scale-105 transition-transform duration-300 shadow-xl inline-block">
                        Browse All Chains
                    </a>
                </div>
            </div>
        </div>
    </section>


    <!-- Moving Tagline -->
    <div class="premium-gradient py-6 overflow-hidden border-y-4 ">
        <div class="scroll-text whitespace-nowrap">
            <span class="text-yellow-400 text-xl font-semibold px-12">
                 Discover Timeless Elegance • Premium Quality Guaranteed • Free Shipping on Orders Above ₹3000 •
                Certified Authentic Jewelry • 30-Day Money Back Guarantee 
            </span>
        </div>
    </div>

    <!-- Featured Rings Section -->
    <section class="py-20 bg-gray-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between mb-12">
                <h3 class="text-3xl font-semibold font-playfair text-gray-800">Exquisite Rings</h3>
                <a href="/shop?category=ring"
                    class="text-yellow-600 hover:text-yellow-700 font-medium flex items-center">
                    View All Rings <i class="fas fa-arrow-right ml-2"></i>
                </a>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <% if (featuredRings && featuredRings.length> 0) { %>
                    <% featuredRings.forEach(product=> { %>
                        <div
                            class="group bg-white premium-shadow rounded-2xl overflow-hidden hover:scale-105 transition-all duration-500">
                            <div class="relative h-80 overflow-hidden">
                                <% if (product.image && product.image.length> 0) { %>
                                    <img src="data:image/jpeg;base64,<%= product.image.toString('base64') %>"
                                        alt="<%= product.name %>"
                                        class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500 bg-[<%= product.bgcolor %>]">
                                    <% } else { %>
                                        <div class="w-full h-full premium-gradient flex items-center justify-center">
                                            <i class="fas fa-ring text-6xl text-yellow-400"></i>
                                        </div>
                                        <% } %>

                                            <!-- Quick Actions Overlay -->
                                            <div
                                                class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-all duration-300 flex items-center justify-center">
                                                <div class="flex space-x-4">
                                                    <% if (loggedin) { %>
                                                        <button onclick="addToWishlist('<%= product._id %>')"
                                                            class="bg-white text-black p-3 rounded-full hover:bg-red-500 hover:text-white transition-all duration-300">
                                                            <i class="fas fa-heart"></i>
                                                        </button>
                                                        <button onclick="addToCart('<%= product._id %>')"
                                                            class="bg-yellow-500 text-black p-3 rounded-full hover:bg-yellow-600 transition-all duration-300">
                                                            <i class="fas fa-shopping-cart"></i>
                                                        </button>
                                                        <% } %>
                                                </div>
                                            </div>

                                            <% if (product.discount> 0) { %>
                                                <div
                                                    class="absolute top-4 left-4 bg-red-500 text-white px-3 py-1 rounded-full text-sm font-bold">
                                                    <%= Math.round((product.discount / product.price) * 100) %>% OFF
                                                </div>
                                                <% } %>
                            </div>

                            <div class="p-6 bg-[<%= product.panelcolor %>]" style="color: <%= product.textcolor %>;">
                                <h4 class="text-xl font-semibold font-playfair mb-2"
                                    style="color: <%= product.textcolor %>;">
                                    <%= product.name || 'Elegant Ring' %>
                                </h4>
                                <p class="mb-4 text-sm opacity-80" style="color: <%= product.textcolor %>;">
                                    <%= product.description || 'Stunning ring design with exceptional craftsmanship' %>
                                </p>

                                <div class="flex items-center mb-4">
                                    <div class="star-rating mr-2">
                                        <% for(let i=1; i <=5; i++) { %>
                                            <i
                                                class="fas fa-star text-sm <%= i <= (product.rating || 4.7) ? 'text-yellow-400' : 'text-gray-300' %>"></i>
                                            <% } %>
                                    </div>
                                    <span class="text-sm opacity-70" style="color: <%= product.textcolor %>;">(<%=
                                            product.reviewCount || Math.floor(Math.random() * 80) + 30 %>)</span>
                                </div>

                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-2">
                                        <span class="text-2xl font-bold" style="color: <%= product.textcolor %>;">₹<%=
                                                product.price ? (product.price - (product.discount || 0)) : '4,999' %>
                                                </span>
                                        <% if (product.discount && product.discount> 0) { %>
                                            <span class="text-lg line-through opacity-60"
                                                style="color: <%= product.textcolor %>;">₹<%= product.price %></span>
                                            <% } %>
                                    </div>

                                    <div class="flex items-center opacity-70" style="color: <%= product.textcolor %>;">
                                        <i class="fas fa-heart text-sm mr-1"></i>
                                        <span class="text-sm">
                                            <%= product.wishlistCount || Math.floor(Math.random() * 40) + 15 %>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <% }) %>
                            <% } else { %>
                                <!-- Placeholder rings -->
                                <% for(let i=0; i < 3; i++) { %>
                                    <div class="bg-white premium-shadow rounded-2xl overflow-hidden">
                                        <div class="h-80 premium-gradient flex items-center justify-center">
                                            <div class="text-center text-yellow-400">
                                                <i class="fas fa-ring text-6xl mb-4"></i>
                                                <p class="text-white">Elegant Ring <%= i + 1 %>
                                                </p>
                                            </div>
                                        </div>
                                        <div class="p-6">
                                            <h4 class="text-xl font-semibold font-playfair text-gray-900 mb-2">Designer
                                                Ring Collection</h4>
                                            <p class="text-gray-600 mb-4 text-sm">Coming soon - Beautiful rings for
                                                every occasion</p>
                                            <div class="flex items-center mb-4">
                                                <div class="star-rating mr-2">
                                                    <% for(let j=1; j <=5; j++) { %>
                                                        <i class="fas fa-star text-sm text-yellow-400"></i>
                                                        <% } %>
                                                </div>
                                                <span class="text-sm text-gray-500">(98)</span>
                                            </div>
                                            <div class="flex items-center justify-between">
                                                <span class="text-2xl font-bold text-gray-900">₹<%= 4999 + (i * 1500) %>
                                                        </span>
                                                <div class="flex items-center text-gray-500">
                                                    <i class="fas fa-heart text-sm mr-1"></i>
                                                    <span class="text-sm">
                                                        <%= 32 + (i * 8) %>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <% } %>
                                        <% } %>
            </div>

            <div class="text-center mt-12">
                <a href="/shop"
                    class="gold-gradient text-black px-8 py-4 rounded-lg font-semibold hover:scale-105 transition-transform duration-300 shadow-xl inline-block">
                    Browse All Rings
                </a>
            </div>
        </div>
    </section>


    <!-- Info Sections -->
    <section class="py-20 bg-amber-200/50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-12">
                <div class="text-center group">
                    <div
                        class="gold-gradient w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform duration-300">
                        <i class="fas fa-shipping-fast text-3xl text-black"></i>
                    </div>
                    <h4 class="text-2xl font-semibold font-playfair text-gray-900 mb-4">Express Delivery</h4>
                    <p class="text-gray-600 leading-relaxed">Free shipping on orders above ₹5000. Express delivery
                        available nationwide with premium packaging.</p>
                </div>
                <div class="text-center group">
                    <div
                        class="gold-gradient w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform duration-300">
                        <i class="fas fa-certificate text-3xl text-black"></i>
                    </div>
                    <h4 class="text-2xl font-semibold font-playfair text-gray-900 mb-4">Certified Quality</h4>
                    <p class="text-gray-600 leading-relaxed">All jewelry comes with authenticity certificates, lifetime
                        warranty, and quality assurance guarantee.</p>
                </div>
                <div class="text-center group">
                    <div
                        class="gold-gradient w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform duration-300">
                        <i class="fas fa-undo-alt text-3xl text-black"></i>
                    </div>
                    <h4 class="text-2xl font-semibold font-playfair text-gray-900 mb-4">Hassle-Free Returns</h4>
                    <p class="text-gray-600 leading-relaxed">30-day money-back guarantee. Easy exchanges and returns
                        with free pickup service.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Featured Bracelets Section -->
    <section class="py-20 bg-gray-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between mb-12">
                <h3 class="text-3xl font-semibold font-playfair text-gray-800">Stunning Bracelets</h3>
                <a href="/shop?category=bracelet"
                    class="text-yellow-600 hover:text-yellow-700 font-medium flex items-center">
                    View All Bracelets <i class="fas fa-arrow-right ml-2"></i>
                </a>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <% if (featuredBracelets && featuredBracelets.length> 0) { %>
                    <% featuredBracelets.forEach(product=> { %>
                        <div
                            class="group bg-white premium-shadow rounded-2xl overflow-hidden hover:scale-105 transition-all duration-500">
                            <div class="relative h-80 overflow-hidden">
                                <% if (product.image && product.image.length> 0) { %>
                                    <img src="data:image/jpeg;base64,<%= product.image.toString('base64') %>"
                                        alt="<%= product.name %>"
                                        class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500 bg-[<%= product.bgcolor %>]">
                                    <% } else { %>
                                        <div class="w-full h-full premium-gradient flex items-center justify-center">
                                            <i class="fas fa-circle text-6xl text-yellow-400"></i>
                                        </div>
                                        <% } %>

                                            <div
                                                class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-all duration-300 flex items-center justify-center">
                                                <div class="flex space-x-4">
                                                    <% if (loggedin) { %>
                                                        <button onclick="addToWishlist('<%= product._id %>')"
                                                            class="bg-white text-black p-3 rounded-full hover:bg-red-500 hover:text-white transition-all duration-300">
                                                            <i class="fas fa-heart"></i>
                                                        </button>
                                                        <button onclick="addToCart('<%= product._id %>')"
                                                            class="bg-yellow-500 text-black p-3 rounded-full hover:bg-yellow-600 transition-all duration-300">
                                                            <i class="fas fa-shopping-cart"></i>
                                                        </button>
                                                        <% } %>
                                                </div>
                                            </div>

                                            <% if (product.discount> 0) { %>
                                                <div
                                                    class="absolute top-4 left-4 bg-red-500 text-white px-3 py-1 rounded-full text-sm font-bold">
                                                    <%= Math.round((product.discount / product.price) * 100) %>% OFF
                                                </div>
                                                <% } %>
                            </div>

                            <div class="p-6 bg-[<%= product.panelcolor %>]" style="color: <%= product.textcolor %>;">
                                <h4 class="text-xl font-semibold font-playfair mb-2"
                                    style="color: <%= product.textcolor %>;">
                                    <%= product.name || 'Beautiful Bracelet' %>
                                </h4>
                                <p class="mb-4 text-sm opacity-80" style="color: <%= product.textcolor %>;">
                                    <%= product.description || 'Stylish bracelet perfect for every occasion' %>
                                </p>

                                <div class="flex items-center mb-4">
                                    <div class="star-rating mr-2">
                                        <% for(let i=1; i <=5; i++) { %>
                                            <i
                                                class="fas fa-star text-sm <%= i <= (product.rating || 4.6) ? 'text-yellow-400' : 'text-gray-300' %>"></i>
                                            <% } %>
                                    </div>
                                    <span class="text-sm opacity-70" style="color: <%= product.textcolor %>;">(<%=
                                            product.reviewCount || Math.floor(Math.random() * 70) + 25 %>)</span>
                                </div>

                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-2">
                                        <span class="text-2xl font-bold" style="color: <%= product.textcolor %>;">₹<%=
                                                product.price ? (product.price - (product.discount || 0)) : '3,499' %>
                                                </span>
                                        <% if (product.discount && product.discount> 0) { %>
                                            <span class="text-lg line-through opacity-60"
                                                style="color: <%= product.textcolor %>;">₹<%= product.price %></span>
                                            <% } %>
                                    </div>

                                    <div class="flex items-center opacity-70" style="color: <%= product.textcolor %>;">
                                        <i class="fas fa-heart text-sm mr-1"></i>
                                        <span class="text-sm">
                                            <%= product.wishlistCount || Math.floor(Math.random() * 35) + 12 %>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <% }) %>
                            <% } else { %>
                                <!-- Placeholder bracelets -->
                                <% for(let i=0; i < 3; i++) { %>
                                    <div class="bg-white premium-shadow rounded-2xl overflow-hidden">
                                        <div class="h-80 premium-gradient flex items-center justify-center">
                                            <div class="text-center text-yellow-400">
                                                <i class="fas fa-circle text-6xl mb-4"></i>
                                                <p class="text-white">Stunning Bracelet <%= i + 1 %>
                                                </p>
                                            </div>
                                        </div>
                                        <div class="p-6">
                                            <h4 class="text-xl font-semibold font-playfair text-gray-900 mb-2">Luxury
                                                Bracelet Collection</h4>
                                            <p class="text-gray-600 mb-4 text-sm">Coming soon - Elegant bracelets for
                                                modern lifestyle</p>
                                            <div class="flex items-center mb-4">
                                                <div class="star-rating mr-2">
                                                    <% for(let j=1; j <=5; j++) { %>
                                                        <i class="fas fa-star text-sm text-yellow-400"></i>
                                                        <% } %>
                                                </div>
                                                <span class="text-sm text-gray-500">(74)</span>
                                            </div>
                                            <div class="flex items-center justify-between">
                                                <span class="text-2xl font-bold text-gray-900">₹<%= 3499 + (i * 800) %>
                                                        </span>
                                                <div class="flex items-center text-gray-500">
                                                    <i class="fas fa-heart text-sm mr-1"></i>
                                                    <span class="text-sm">
                                                        <%= 28 + (i * 6) %>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <% } %>
                                        <% } %>
            </div>

            <div class="text-center mt-12">
                <a href="/shop"
                    class="gold-gradient text-black px-8 py-4 rounded-lg font-semibold hover:scale-105 transition-transform duration-300 shadow-xl inline-block">
                    Browse All Bracelets
                </a>
            </div>
        </div>
    </section>


    <!-- About Section -->
    <section class="py-24 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16">
                <h2 class="text-4xl md:text-5xl font-bold font-playfair text-gray-900 mb-6">About Veloura</h2>
                <p class="text-xl text-gray-600 max-w-3xl mx-auto">
                    Crafting timeless jewelry pieces that celebrate life's precious moments with unparalleled elegance
                    and sophistication
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-16 items-center">
                <div>
                    <h3 class="text-3xl font-semibold font-playfair text-gray-900 mb-8">Our Legacy of Excellence</h3>
                    <p class="text-gray-600 mb-6 text-lg leading-relaxed">
                        At Veloura, we believe that jewelry is more than just an accessory – it's a reflection of your
                        unique style, personality, and the stories you carry. Founded with an unwavering passion for
                        exceptional craftsmanship and timeless design, we curate the finest collection of chains, rings,
                        and bracelets for the most discerning customers.
                    </p>
                    <p class="text-gray-600 mb-8 text-lg leading-relaxed">
                        Each piece in our collection undergoes rigorous quality checks and is crafted with precision
                        by master artisans. From elegant everyday pieces that complement your daily style to statement
                        jewelry for life's most special occasions, we ensure that every item meets our exacting
                        standards of excellence and authenticity.
                    </p>

                    <div class="grid grid-cols-3 gap-8 mb-8">
                        <div class="text-center">
                            <div class="text-4xl font-bold text-yellow-600 mb-2">2000+</div>
                            <div class="text-sm text-gray-600 uppercase tracking-wide">Happy Customers</div>
                        </div>
                        <div class="text-center">
                            <div class="text-4xl font-bold text-yellow-600 mb-2">800+</div>
                            <div class="text-sm text-gray-600 uppercase tracking-wide">Unique Designs</div>
                        </div>
                        <div class="text-center">
                            <div class="text-4xl font-bold text-yellow-600 mb-2">4.9★</div>
                            <div class="text-sm text-gray-600 uppercase tracking-wide">Customer Rating</div>
                        </div>
                    </div>

                    <div class="flex space-x-4">
                        <a href="/shop"
                            class="bg-amber-200 border text-black px-6 py-3 rounded-lg font-semibold hover:scale-105 transition-transform duration-300">
                            Explore Collection
                        </a>
                        <a href="#"
                            class="border-2 border-gray-300 text-gray-700 px-6 py-3 rounded-lg font-semibold hover:border-yellow-600 hover:text-yellow-600 transition-colors duration-300">
                            Our Story
                        </a>
                    </div>
                </div>

                <div class="relative">
                    <div class="premium-gradient rounded-3xl h-96 flex items-center justify-center premium-shadow">
                        <div class="text-center">
                            <i class="fas fa-gem text-yellow-400 text-8xl mb-4"></i>
                            <p class="text-white text-xl font-playfair">Crafted with Precision</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="premium-gradient text-white py-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-12">
                <div class="md:col-span-2">
                    <div class="flex items-center mb-6">
                        <h3 class="text-3xl font-bold font-playfair">
                            <span class="text-white">VEL</span><span class="text-yellow-400">OURA</span>
                        </h3>
                    </div>
                    <p class="text-gray-300 mb-6 text-lg leading-relaxed max-w-md">
                        Your trusted partner for luxury jewelry. We craft memories, one exquisite piece at a time,
                        with dedication to quality and timeless elegance.
                    </p>
                    <div class="flex space-x-6">
                        <a href="#" class="text-gray-400 hover:text-yellow-400 transition-colors duration-300 text-2xl">
                            <i class="fab fa-facebook"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-yellow-400 transition-colors duration-300 text-2xl">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-yellow-400 transition-colors duration-300 text-2xl">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-yellow-400 transition-colors duration-300 text-2xl">
                            <i class="fab fa-pinterest"></i>
                        </a>
                    </div>
                </div>

                <div>
                    <h4 class="text-lg font-semibold mb-6 text-yellow-400">Quick Links</h4>
                    <ul class="space-y-3">
                        <li><a href="/shop" class="text-gray-300 hover:text-white transition-colors duration-300">Shop
                                All</a></li>
                        <li><a href="/shop?category=chain"
                                class="text-gray-300 hover:text-white transition-colors duration-300">Premium Chains</a>
                        </li>
                        <li><a href="/shop?category=ring"
                                class="text-gray-300 hover:text-white transition-colors duration-300">Elegant Rings</a>
                        </li>
                        <li><a href="/shop?category=bracelet"
                                class="text-gray-300 hover:text-white transition-colors duration-300">Stunning
                                Bracelets</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-white transition-colors duration-300">Gift
                                Cards</a></li>
                    </ul>
                </div>

                <div>
                    <h4 class="text-lg font-semibold mb-6 text-yellow-400">Customer Care</h4>
                    <ul class="space-y-3">
                        <li><a href="#" class="text-gray-300 hover:text-white transition-colors duration-300">Contact
                                Us</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-white transition-colors duration-300">Shipping &
                                Returns</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-white transition-colors duration-300">Size
                                Guide</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-white transition-colors duration-300">Care
                                Instructions</a></li>
                        <li><a href="#"
                                class="text-gray-300 hover:text-white transition-colors duration-300">Warranty</a></li>
                    </ul>
                </div>
            </div>

            <div class="border-t border-gray-800 mt-12 pt-8">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <p class="text-gray-400 mb-4 md:mb-0">
                        © 2025 Veloura. All rights reserved. | Crafted with ♥ for jewelry enthusiasts worldwide
                    </p>
                    <div class="flex space-x-6">
                        <a href="#"
                            class="text-gray-400 hover:text-white transition-colors duration-300 text-sm">Privacy
                            Policy</a>
                        <a href="#" class="text-gray-400 hover:text-white transition-colors duration-300 text-sm">Terms
                            of Service</a>
                        <a href="#"
                            class="text-gray-400 hover:text-white transition-colors duration-300 text-sm">Licensing</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- JavaScript - FIXED VERSION -->
    <script>
        let currentSlide = 0;
        const totalSlides = <%= heroImages.length %>;

        function goToSlide(index) {
            currentSlide = index;
            updateCarousel();
        }

        function nextSlide() {
            currentSlide = (currentSlide + 1) % totalSlides;
            updateCarousel();
        }

        function previousSlide() {
            currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
            updateCarousel();
        }

        function updateCarousel() {
            const carousel = document.getElementById('carousel');
            carousel.style.transform = `translateX(-${currentSlide * 100}%)`;

            // Update dots
            document.querySelectorAll('.carousel-dot').forEach((dot, index) => {
                if (index === currentSlide) {
                    dot.classList.add('bg-yellow-400', 'scale-125');
                    dot.classList.remove('bg-white/50');
                } else {
                    dot.classList.remove('bg-yellow-400', 'scale-125');
                    dot.classList.add('bg-white/50');
                }
            });
        }

        // Auto-advance carousel
        setInterval(() => {
            nextSlide();
        }, 6000);

        // Search functionality
        const searchCategories = ['Chains', 'Bracelets', 'Rings'];
        let currentCategoryIndex = 0;

        function updateSearchPlaceholder() {
            const searchInput = document.getElementById('searchInput');
            searchInput.placeholder = `Search for "${searchCategories[currentCategoryIndex]}"...`;
            currentCategoryIndex = (currentCategoryIndex + 1) % searchCategories.length;
        }

        // Update placeholder every 3 seconds
        setInterval(updateSearchPlaceholder, 3000);

        function handleSearch(event) {
            const query = event.target.value;
            if (event.key === 'Enter') {
                performSearch();
            } else if (query.length > 0) {
                fetchSearchSuggestions(query);
            } else {
                hideSuggestions();
            }
        }

        function performSearch() {
            const query = document.getElementById('searchInput').value;
            if (query.trim()) {
                window.location.href = `/shop?search=${encodeURIComponent(query)}`;
            }
        }

        function fetchSearchSuggestions(query) {
            // Mock suggestions - in a real app, this would fetch from your API
            const mockProducts = [
                'Gold Chain Classic', 'Silver Chain Modern', 'Diamond Ring Elegant',
                'Pearl Bracelet Luxury', 'Platinum Ring Designer', 'Rose Gold Chain Vintage'
            ];

            const suggestions = mockProducts.filter(product =>
                product.toLowerCase().includes(query.toLowerCase())
            ).slice(0, 5);

            displaySuggestions(suggestions);
        }

        function displaySuggestions(suggestions) {
            const suggestionsContainer = document.getElementById('searchSuggestions');
            suggestionsContainer.innerHTML = '';

            if (suggestions.length > 0) {
                suggestions.forEach(suggestion => {
                    const item = document.createElement('div');
                    item.className = 'suggestion-item';
                    item.textContent = suggestion;
                    item.onclick = () => {
                        document.getElementById('searchInput').value = suggestion;
                        hideSuggestions();
                        performSearch();
                    };
                    suggestionsContainer.appendChild(item);
                });
                suggestionsContainer.classList.add('show');
            } else {
                hideSuggestions();
            }
        }

        function showSuggestions() {
            const query = document.getElementById('searchInput').value;
            if (query.length > 0) {
                fetchSearchSuggestions(query);
            }
        }

        function hideSuggestions() {
            setTimeout(() => {
                document.getElementById('searchSuggestions').classList.remove('show');
            }, 200);
        }

        // FIXED Dynamic badge update functions
        function updateCartBadge(count) {
            const cartBadge = document.getElementById('cartBadge');
            if (cartBadge) {
                cartBadge.textContent = count;
                if (count > 0) {
                    cartBadge.classList.remove('hidden');
                    cartBadge.classList.add('animate');
                    setTimeout(() => cartBadge.classList.remove('animate'), 500);
                } else {
                    cartBadge.classList.add('hidden');
                }

                // Debug log
                console.log('Cart badge updated to:', count);
            } else {
                console.log('Cart badge element not found');
            }
        }

        function updateWishlistBadge(count) {
            const wishlistBadge = document.getElementById('wishlistBadge');
            if (wishlistBadge) {
                wishlistBadge.textContent = count;
                if (count > 0) {
                    wishlistBadge.classList.remove('hidden');
                    wishlistBadge.classList.add('animate');
                    setTimeout(() => wishlistBadge.classList.remove('animate'), 500);
                } else {
                    wishlistBadge.classList.add('hidden');
                }

                // Debug log
                console.log('Wishlist badge updated to:', count);
            } else {
                console.log('Wishlist badge element not found');
            }
        }

        // FIXED Add to cart functionality
        function addToCart(productId) {
            <% if (loggedin) { %>
                fetch(`/addtocart/${productId}`, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (data.success) {
                            showNotification('Added to cart!', 'success');
                            // Update cart badge with new count
                            updateCartBadge(data.cartCount);
                        } else {
                            showNotification(data.message || 'Error adding to cart', 'error');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        showNotification('Error adding to cart', 'error');
                    });
            <% } else { %>
                showNotification('Please login to add items to cart', 'warning');
                setTimeout(() => {
                    window.location.href = '/users/register';
                }, 2000);
            <% } %>
        }

        // FIXED Add to wishlist functionality with toggle
        function addToWishlist(productId) {
            <% if (loggedin) { %>
                fetch(`/addtowishlist/${productId}`, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (data.success) {
                            showNotification(data.message, 'success');
                            // Update wishlist badge with new count
                            updateWishlistBadge(data.wishlistCount);

                            // Update the heart icon appearance if needed
                            const heartIcon = document.querySelector(`[onclick="addToWishlist('${productId}')"] i`);
                            if (heartIcon) {
                                if (data.isInWishlist === false) {
                                    // Item was removed from wishlist
                                    heartIcon.classList.remove('text-red-500');
                                    heartIcon.classList.add('text-gray-400');
                                } else {
                                    // Item was added to wishlist
                                    heartIcon.classList.remove('text-gray-400');
                                    heartIcon.classList.add('text-red-500');
                                }
                            }
                        } else {
                            showNotification(data.message || 'Error updating wishlist', 'error');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        showNotification('Error updating wishlist', 'error');
                    });
            <% } else { %>
                showNotification('Please login to add items to wishlist', 'warning');
                setTimeout(() => {
                    window.location.href = '/users/register';
                }, 2000);
            <% } %>
        }

        // Notification system
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 transition-all duration-300 ${type === 'success' ? 'bg-green-500 text-white' :
                type === 'error' ? 'bg-red-500 text-white' :
                    type === 'warning' ? 'bg-yellow-500 text-black' :
                        'bg-blue-500 text-white'
                }`;
            notification.textContent = message;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Smooth scroll for internal links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
    </script>
</body>

</html>